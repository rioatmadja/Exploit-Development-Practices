#!/usr/bin/python 
# Name: Rio Atmadja
# Script: python ftp command fuzzers
import os,socket,time,sys

#function to fuzz the command parameter 
def fuzz_command(host,port,byte):
	evil_buffer = ['\x41'] #create an evil buffer 
	for i in range(2,int(byte),20):
		evil_buffer.append('\x41' * i ) #multiply by ith 

	#ftp command to send to the server 
	commands=["LIST","ACCT","CWD","CDUP","SMNT","REIN","PASV","TYPE","STRU","MODE","RETR","STOR","STOU","APPE","ALLO","REST","RNFR","RNTO","ABOR","DELE","RMD","MKD","PWD","NLST","SITE","SYST","STAT","HELP"]

	#loop through each command 
	for command in commands: 
		for string in evil_buffer:
			print "Sending Evil Command " + command + " with length:" + str(len(string))
			s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
			connect = s.connect(("127.0.0.1", int(port))) 
			s.send('user jeff\r\n')
			s.recv(1024)
			s.send('pass 123qwe\r\n')
			s.recv(1024)
			s.send(command + ' ' + string + '\r\n')
			s.recv(1024)
			s.send('QUIT\r\n')
			s.recv(1024)
			s.close()
			#time.sleep(1)

#function to fuzz the name parameter
def fuzz_username(host,port,byte):

        password = "user"
        username = '\x41' * int(byte) 
        print "Sending Evil Username --> " + str(len(username)) + " bytes" 
        connect = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

        try:
                connect.connect((host,int(port)))

        except:

                print "[-] Connection Error"
                response = connect.recv(1024)
                print response
                sys.exit(1)

        #send username to the server 
        connect.send("user %s\r\n" %username)
        response = connect.recv(1024)

        #send password to the server 
        connect.send("pass %s\r\n" %password)
        response = connect.recv(1024)

#function to fuzz the password parameter
def fuzz_password(host,port,byte):

        username = "jeff"
        password = '\x41' * int(byte) 
        print "Sending Evil Password --> " + str(len(password)) + " bytes" 
        connect = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

        try:
                connect.connect((host,int(port)))

        except:

                print "[-] Connection Error"
                response = connect.recv(1024)
                print response
                sys.exit(1)

        #send username to the server 
        connect.send("user %s\r\n" %username)
        response = connect.recv(1024)

        #send password to the server 
        connect.send("pass %s\r\n" %password)
        response = connect.recv(1024)

#main function of ftp fuzzer 
if __name__ == '__main__':
	try:
		host = sys.argv[1] #host name
		port = sys.argv[2] #port number 
		byte = sys.argv[3] #byte size 

	except IndexError:
		print("\t\tCustom ftp fuzzers \n")
		print 'Usage: %s <host> <port> <byte> ' % sys.argv[0]
		sys.exit(-1)

	print "FUZZING FTP COMMAND in progress ..............", "\n"
	fuzz_command(host,port,byte)
	time.sleep(1)	
	
	print "\n"
	print "FUZZING FTP USERNAME in progress ..............", "\n"
	for i in range(2,int(byte),20):
		fuzz_username(host,port,i)
		#time.sleep(1)

	print "\n"
	print "FUZZING FTP PASSOWRD in progress ..............", "\n"
	for i in range(2,int(byte),20):
		fuzz_password(host,port,i)
		time.sleep(3)
